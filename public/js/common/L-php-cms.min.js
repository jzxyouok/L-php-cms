/*!  31-07-2017 */

var app=angular.module("myApp",["ngSanitize"]);app.factory("adminLoginService",["$http",function(a){return{get:function(b,c,d){return a({method:"POST",url:"admin_login",data:$.param({username:b,password:c,code:d}),headers:{"content-type":"application/x-www-form-urlencoded"}})},updateCode:function(){return a({method:"POST",url:"admin_login_update_code",data:$.param({data:Math.random()}),headers:{"content-type":"application/x-www-form-urlencoded"}})},getCode:function(){return a({method:"POST",url:"admin_login_get_code",data:$.param({data:Math.random()}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("adminUserAddService",["$http",function(a){return{get:function(b,c,d,e,f,g,h,i,j,k){return a({method:"POST",url:"add",data:$.param({adminUser_username:b,adminUser_nickname:c,adminUser_avatar:d,adminUser_password:e,adminUser_repassword:f,adminUser_userGroup:g,adminUser_status:h,adminUser_phone:i,adminUser_email:j,adminUser_remark:k}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("adminUserAllService",["$http",function(a){return{adminUserGet:function(){return a({method:"GET",url:"/admin/manage/user_manage/admin_user_get",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},uploadAvatarForAdminUser:function(b,c){return a({method:"POST",url:"/admin/manage/user_manage/upload_avatar_for_admin_user",data:$.param({id:b,avatar:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("adminUserGroupAddService",["$http",function(a){return{get:function(b,c,d,e,f){return a({method:"POST",url:"admin_user_group_add",data:$.param({group_id:b,name:c,pid:d,status:e,remark:f}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},edit:function(b,c,d,e){return a({method:"POST",url:"/admin/manage/user_manage/user_group_edit",data:$.param({group_id:b,name:c,pid:d,remark:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("adminUserGroupAllService",["$http",function(a){return{get:function(){return a({method:"GET",url:"admin_user_group_get",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},modify:function(b,c){return a({method:"POST",url:"/admin/manage/user_manage/modify_power",data:$.param({name:b,power:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},forbidden:function(b){return a({method:"POST",data:$.param({name:b}),url:"/admin/manage/user_manage/forbidden_status",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},startUsing:function(b){return a({method:"POST",data:$.param({name:b}),url:"start_using",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("bannerManageService",["$http",function(a){return{bannerItemAddCommit:function(b,c){return a({method:"POST",url:"/admin/manage/doc_manage/banner_manage_add",data:$.param({name:b,remark:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},bannerGet:function(){return a({method:"GET",url:"/admin/manage/doc_manage/banner_manage_get",headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("bannerManageEditService",["$http",function(a){return{saveSlider:function(b,c,d){return a({method:"POST",url:"/admin/manage/doc_manage/banner_edit_save_slider",data:$.param({bannerId:b,sliderDataExist:c,sliderDataNewAllFormat:d}),headers:{"content-type":"application/x-www-form-urlencoded"}})},sliderGet:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/banner_edit_slider_get",data:$.param({bannerId:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("basicInfoService",["$http",function(a){return{saveSlider:function(b,c,d){return a({method:"POST",url:"/admin/manage/doc_manage/banner_edit_save_slider",data:$.param({bannerId:b,sliderDataExist:c,sliderDataNewAllFormat:d}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("categoryAddService",["$http",function(a){return{addCategory:function(b,c,d,e,f){return a({method:"POST",url:"/admin/manage/doc_manage/category_add",data:$.param({name:b,slug:c,order:d,parent:e,remark:f}),headers:{"content-type":"application/x-www-form-urlencoded"}})},editCategoryCommit:function(b,c,d,e,f){return a({method:"POST",url:"/admin/manage/doc_manage/category_edit",data:$.param({name:b,slug:c,order:d,parent:e,remark:f}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("categoryAllService",["$http",function(a){return{get:function(b,c,d,e,f,g,h,i,j,k,l,m){a({method:"POST",url:"admin/manage/articles_add",data:$.param({title:b,from:c,display:d,tags:e,img:f,parent:g,keywords:h,description:i,type:j,view:k,author:l,content:m}),headers:{"content-type":"application/x-www-form-urlencoded"}})},getCategories:function(){return a({method:"GET",url:"/admin/manage/doc_manage/category_get",headers:{"content-type":"application/x-www-form-urlencoded"}})},editCategoryCommit:function(b,c,d,e,f,g){return a({method:"POST",url:"/admin/manage/doc_manage/category_edit_commit",data:$.param({id:b,name:c,slug:d,parent:e,order:f,remark:g}),headers:{"content-type":"application/x-www-form-urlencoded"}})},removeCommit:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/category_remove_commit",data:$.param({id:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("documentAllService",["$http",function(a){return{postLimitAndPage:function(b,c){return a({method:"POST",url:"/admin/manage/document_manage/get_yes_display_document",data:$.param({limit:b,page:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},removeOneDocument:function(b){return a({method:"POST",url:"/admin/manage/document_manage/remove_one_document",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},putIntoRecycle:function(b){return a({method:"POST",url:"/admin/manage/document_manage/put_into_recycle",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("documentEditService",["$http",function(a){return{get:function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){return a({method:"POST",url:"/admin/manage/document_manage/write",data:$.param({document_title:b,document_from:c,document_display:d,document_hot:e,document_recommend:f,document_tags:g,document_img:h,document_category:i,document_keywords:j,document_abstract:k,document_type:l,document_view:m,document_author:n,document_content:o}),headers:{"content-type":"application/x-www-form-urlencoded"}})},postEditId:function(b){return a({method:"POST",url:"/admin/manage/document_manage/edit/",data:$.param({id:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},update:function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){return a({method:"POST",url:"/admin/manage/document_manage/update/",data:$.param({id:b,title:c,from:d,display:e,hot:f,recommend:g,tags:h,category:i,keywords:j,abstract:k,type:l,view:m,author:n,content:o}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("docWriteService",["$http",function(a){return{get:function(b,c,d,e,f,g,h,i,j,k,l){return a({method:"POST",url:"/admin/manage/doc_manage/write",data:$.param({type:b,title:c,previewImg:d,tag:e,category:f,abstract:g,keyword:h,view:i,author:j,from:k,content:l}),headers:{"content-type":"application/x-www-form-urlencoded"}})},gatherDocCommit:function(b,c){return a({method:"POST",url:"/admin/manage/doc_manage/gather_doc_commit",data:$.param({id:b,url:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("draftService",["$http",function(a){return{postLimitAndPage:function(b,c){return a({method:"POST",url:"/admin/manage/document_manage/get_draft_document",data:$.param({limit:b,page:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},removeOneDocument:function(b){return a({method:"POST",url:"/admin/manage/document_manage/remove_one_document",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},putIntoRecycle:function(b){return a({method:"POST",url:"/admin/manage/document_manage/put_into_recycle",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("editDocService",["$http",function(a){return{getDocById:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/get_doc_by_id",data:$.param({id:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},updateDoc:function(b,c,d,e,f,g,h,i,j,k,l,m){return a({method:"POST",url:"/admin/manage/doc_manage/update_doc",data:$.param({id:b,type:c,title:d,previewImg:e,tag:f,category:g,abstract:h,keyword:i,view:j,author:k,from:l,content:m}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("gatherManageService",["$http",function(a){return{getGather:function(){return a({method:"GET",url:"/admin/manage/doc_manage/get_gather",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},addGather:function(b,c,d){return a({method:"POST",url:"/admin/manage/doc_manage/add_gather",data:$.param({siteName:b,docTitle:c,docContent:d}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},autoGather:function(b,c,d){return a({method:"POST",url:"/admin/manage/doc_manage/auto_gather",data:$.param({siteName:b,docTitle:c,docContent:d}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("headerCtrlService",["$http",function(a){return{logout:function(){return a({method:"GET",url:"/admin/manage/logout",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("mediaManageAllService",["$http",function(a){return{getAllMedia:function(b){return a({method:"GET",url:"/admin/manage/file_manage/media_manage_get",headers:{"content-type":"application/x-www-form-urlencoded"}})},filterData:function(b,c,d){return a({method:"POST",url:"/admin/manage/file_manage/media_manage_get_filter",data:$.param({type_real:b,upload_time:c,limit:d}),headers:{"content-type":"application/x-www-form-urlencoded"}})},goToPage:function(b,c,d,e){return a({method:"POST",url:"/admin/manage/file_manage/media_manage_get_filter_go_to_page",data:$.param({type_real:b,upload_time:c,limit:d,page:e}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("mediaManageService",["$http",function(a){return{get:function(b,c){return a({method:"POST",url:"/admin/manage/panel/password_modify",data:$.param({adminUser_password:b,adminUser_repassword:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("menuManageService",["$http",function(a){return{addMenuCommit:function(b,c,d,e,f){return a({method:"POST",url:"/admin/manage/doc_manage/add_menu_commit",data:$.param({name:b,url:c,target:d,parent:e,order:f}),headers:{"content-type":"application/x-www-form-urlencoded"}})},getMenu:function(){return a({method:"GET",url:"/admin/manage/doc_manage/get_menu",headers:{"content-type":"application/x-www-form-urlencoded"}})},removeMenuCommit:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/remove_menu",data:$.param({id:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},editMenuCommit:function(b,c,d,e,f,g){return a({method:"POST",url:"/admin/manage/doc_manage/edit_menu",data:$.param({id:b,name:c,url:d,target:e,parent:f,order:g}),headers:{"content-type":"application/x-www-form-urlencoded"}})},getParentMenu:function(){return a({method:"GET",url:"/admin/manage/doc_manage/get_parent_menu",headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("modifyPasswordService",["$http",function(a){return{get:function(b,c){return a({method:"POST",url:"/admin/manage/panel/password_modify",data:$.param({adminUser_password:b,adminUser_repassword:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("noAccessService",["$http",function(a){return{postLimitAndPage:function(b,c){return a({method:"POST",url:"/admin/manage/document_manage/get_no_access_document",data:$.param({limit:b,page:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},removeOneDocument:function(b){return a({method:"POST",url:"/admin/manage/document_manage/remove_one_document",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},putIntoRecycle:function(b){return a({method:"POST",url:"/admin/manage/document_manage/put_into_recycle",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("publishedService",["$http",function(a){return{getPublishedByLimitAndCurrentPage:function(b,c){return a({method:"POST",url:"/admin/manage/doc_manage/get_published_doc",data:$.param({limit:b,currentPage:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},recommend:function(b,c){return a({method:"POST",url:"/admin/manage/doc_manage/recommend_doc",data:$.param({isRec:b,id:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},hot:function(b,c){return a({method:"POST",url:"/admin/manage/doc_manage/hot_doc",data:$.param({isRec:b,id:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},removeOneDoc:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/remove_one_document",data:$.param({doc:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},putIntoRecycle:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/put_into_recycle",data:$.param({doc:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("recycleService",["$http",function(a){return{postLimitAndPage:function(b,c){return a({method:"POST",url:"/admin/manage/document_manage/get_no_display_document",data:$.param({limit:b,page:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})},removeOneDocument:function(b){return a({method:"POST",url:"/admin/manage/document_manage/remove_one_document",data:$.param({data:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("userGroupManageService",["$http",function(a){return{addAdminUserGroup:function(b,c,d,e,f){return a({method:"POST",url:"/admin/manage/add_user_group",data:$.param({group_id:b,name:c,pid:d,status:e,remark:f}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},getUserGroup:function(){return a({method:"GET",url:"get_user_group",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},powerCommit:function(b,c){return a({method:"POST",url:"/admin/manage/user_group_manage/modify_power",data:$.param({name:b,power:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},forbidden:function(b){return a({method:"POST",data:$.param({name:b}),url:"/admin/manage/user_group_manage/forbidden_status",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},startUsing:function(b){return a({method:"POST",data:$.param({name:b}),url:"/admin/manage/user_group_manage/start_using",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},editCommit:function(b,c,d,e){return a({method:"POST",url:"/admin/manage/user_manage/user_group_edit",data:$.param({group_id:b,name:c,pid:d,remark:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),app.factory("verifyDocService",["$http",function(a){return{getDocById:function(b){return a({method:"POST",url:"/admin/manage/doc_manage/get_doc_by_id",data:$.param({id:b}),headers:{"content-type":"application/x-www-form-urlencoded"}})},verifyDoc:function(b,c,d,e,f,g,h,i,j,k,l,m){return a({method:"POST",url:"/admin/manage/doc_manage/verify_doc",data:$.param({id:b,type:c,title:d,previewImg:e,tag:f,category:g,abstract:h,keyword:i,view:j,author:k,from:l,content:m}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.factory("waitForVerifyService",["$http",function(a){return{getWaitForVerifyByLimitAndCurrentPage:function(b,c){return a({method:"POST",url:"/admin/manage/doc_manage/get_wait_for_verify_doc",data:$.param({limit:b,currentPage:c}),headers:{"content-type":"application/x-www-form-urlencoded"}})}}}]),app.directive("pwCheck",[function(){return{require:"ngModel",link:function(a,b,c,d){var e="#"+c.pwCheck;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(e).val();d.$setValidity("pwmatch",a)})})}}}]),app.filter("trustHtml",function(a){return function(b){return a.trustAsHtml(b)}}),app.filter("sizeFormat",function(){return function(a){return Math.round(a/1024)+" KB"}}),app.filter("urlCut",function(){return function(a){return a.match(/\/public\/upload\/(image|zip|rar|pdf)\/\d{8}/)[0]}}),app.filter("urlCutNoNumber",function(){return function(a){return a.match(/\/public\/upload\/(zip|rar|pdf)/)[0]}}),app.controller("adminLogin",["$scope","$http","adminLoginService",function(a,b,c){a.login=function(){c.get(a.username,a.password,a.code).then(function(b){1===b.data.code?window.location.href="manage/panel/basic_info":0===b.data.code&&(a.msg=b.data.msg)},function(a){})},a.updateCode=function(){c.updateCode().then(function(b){1===b.data.code&&(a.base64=b.data.base64)},function(a){})},a.getCode=function(){c.getCode().then(function(b){1===b.data.code&&(a.base64=b.data.base64)},function(a){})}}]),app.controller("adminUserAdd",["$scope","$http","adminUserAddService",function(a,b,c){a.addAdminUser=function(){var b=1;switch(a.adminUser_userGroup){case 1:b="超级管理员";break;case 2:b="网站管理员";break;case 3:b="内容管理员";break;case 4:b="投稿员"}if(!a.myForm.$valid)return!1;c.get(a.adminUser_username,a.adminUser_nickname,a.logo,a.adminUser_password,a.adminUser_repassword,b,a.adminUser_status,a.adminUser_phone,a.adminUser_email,a.adminUser_remark).then(function(a){},function(a){})},a.userGroupOptions=[{name:"超级管理员",id:1},{name:"网站管理员",id:2},{name:"内容管理员",id:3},{name:"投稿员",id:4}],a.adminUser_userGroup=a.userGroupOptions[0].id,a.statusOptions=[{name:"启用",id:1},{name:"禁用",id:0}],a.adminUser_status=a.statusOptions[0].id,a.checkUsername=function(c){var d=$.trim(c);if(a.isUsernameExist=!1,""==d)return!1;b({method:"POST",url:"add",data:$.param({adminUser_username:d}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){0==b.data.code&&(a.isUsernameExist=!0)},function(a){})},a.logo="/upload/images/defaultlogo.png",$("#admin_user_add_avatar_upload").uploadify({swf:"/plugins/uploadify/uploadify.swf",uploader:"/admin/manage/users_manage/upload?adminId=adminUser_username&type=images&key=adminUser_avatar",buttonText:"上传图片",buttonClass:"uploadify-btn-default",width:100,height:30,fileTypeDesc:"Image Files",fileTypeExts:"*.gif; *.jpg; *.png",fileSizeLimit:"2000KB",auto:!0,multi:!1,onUploadSuccess:function(b,c,d){$("#adminUser_avatar_preview").attr("src",c),a.logo=c}})}]),app.controller("adminUserAll",["$scope","$http","adminUserAllService",function(a,b,c){a.logo="/public/upload/image/author-avatar.jpg",a.adminUserGet=function(){c.adminUserGet().then(function(b){a.data=b.data},function(a){})},a.uploadAvatar=function(b){a.username=b.username,a.id=b.id},a.uploadAvatarForAdminUser=function(b){c.uploadAvatarForAdminUser(a.id,b).then(function(a){1===a.data.code&&$("#admin_user_all_avatar_modal").modal("hide")},function(a){})}}]),app.controller("adminUserGroupAdd",["$scope","$http","adminUserGroupAddService",function(a,b,c){a.statusOptions=[{name:"启用",id:1},{name:"禁用",id:0}],a.status=a.statusOptions[0].id,a.pidOptions=[{name:"无",id:0},{name:"超级管理员",id:1},{name:"网站管理员",id:2},{name:"内容管理员",id:3},{name:"投稿员",id:4}],a.pid=a.pidOptions[0].id,a.addAdminUserGroup=function(){var b=a.name,d=a.pid,e=a.status,f=a.remark,g="超级管理员";switch(b){case"超级管理员":g=1;break;case"网站管理员":g=2;break;case"内容管理员":g=3}c.get(g,b,d,e,f).then(function(b){!0===b.data.code?(a.msg=b.data.msg,$("#admin_user_group_add_modal").modal({keyboard:!0})):!1===b.data.code&&(a.msg=b.data.msg,$("#admin_user_group_add_modal").modal({keyboard:!0}))},function(a){})},$("#myModal").on("hidden.bs.modal",function(){window.location="/admin/users_group"}),$("#myModal").on("hide.bs.modal",function(){window.location="/admin/users_group"})}]),app.controller("usersGroup",["$scope","$http","adminUserGroupAllService","adminUserGroupAddService",function(a,b,c,d){function e(){i=$.fn.zTree.getZTreeObj("treeDemo"),py=$("#py").attr("checked")?"p":"",sy=$("#sy").attr("checked")?"s":"",pn=$("#pn").attr("checked")?"p":"",sn=$("#sn").attr("checked")?"s":"",type={Y:py+sy,N:pn+sn},i.setting.check.chkboxType=type,f('setting.check.chkboxType = { "Y" : "'+type.Y+'", "N" : "'+type.N+'" };')}function f(a){h||(h=$("#code")),h.empty(),h.append("<li>"+a+"</li>")}function g(){c.get().then(function(b){a.data=b.data},function(a){})}g();var h,i,j={check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"ps",N:"ps"}},data:{simpleData:{enable:!0}},callback:{}},k=[{id:"panel",pId:0,name:"仪表盘",open:!0,children:[{id:"basic_info",pId:"panel",name:"基本信息"},{id:"modify_password",pId:"panel",name:"修改密码"}]},{id:"user_manage",pId:0,name:"用户管理",open:!0,children:[{id:"admin_user_group_all",pId:"user_manage",name:"所有用户组"},{id:"admin_user_group_add",pId:"user_manage",name:"添加用户组"},{id:"admin_user_all",pId:"user_manage",name:"所有用户"},{id:"admin_user_add",pId:"user_manage",name:"添加用户"}]},{id:"doc_manage",pId:0,name:"文档管理",open:!0,children:[{id:"category_manage",pId:"doc_manage",name:"分类管理",open:!0,children:[{id:"doc_category_all",pId:"category_manage",name:"文档分类"},{id:"doc_category_add",pId:"category_manage",name:"添加分类"}]},{id:"menu_manage",pId:"doc_manage",name:"菜单管理",open:!0,children:[{id:"menu_edit",pId:"menu_manage",name:"编辑菜单"},{id:"menu_location",pId:"menu_manage",name:"菜单位置"}]},{id:"tag_manage",pId:"doc_manage",name:"标签管理"},{id:"comment_manage",pId:"doc_manage",name:"评论管理"},{id:"message_manage",pId:"doc_manage",name:"消息管理"},{id:"write",pId:"doc_manage",name:"写文档"},{id:"published",pId:"doc_manage",name:"已发布"},{id:"wait_for_verify",pId:"doc_manage",name:"待审核"},{id:"no_access",pId:"doc_manage",name:"未通过"},{id:"draft",pId:"doc_manage",name:"草稿箱"},{id:"recycle",pId:"doc_manage",name:"回收站"}]},{id:"file_manage",pId:0,name:"文件管理",open:!0,children:[{id:"media_manage",pId:"file_manage",name:"媒体管理"},{id:"file_backup",pId:"file_manage",name:"文件备份"},{id:"file_recover",pId:"file_manage",name:"文件恢复"}]},{id:"data_manage",pId:0,name:"数据管理",open:!0,children:[{id:"database_manage",pId:"data_manage",name:"数据库管理",open:!0,children:[{id:"database_backup",pId:"data_manage",name:"数据库备份"},{id:"database_import",pId:"data_manage",name:"数据库导入"},{id:"database_compress",pId:"data_manage",name:"数据库压缩"},{id:"database_optimise",pId:"data_manage",name:"数据库优化"}]},{id:"cache_manage",pId:"data_manage",name:"缓存管理",open:!0,children:[{id:"cache_clear",pId:"cache_manage",name:"缓存清理"},{id:"cache_settings",pId:"cache_manage",name:"缓存设置"}]},{id:"count_manage",pId:"data_manage",name:"统计管理",open:!0,children:[{id:"data_count",pId:"count_manage",name:"数据统计"}]}]},{id:"Custom_center",pId:0,name:"定制中心",open:!0,children:[{id:"theme_manage",pId:"Custom_center",name:"主题管理"},{id:"plugin_manage",pId:"Custom_center",name:"插件管理"},{id:"hook_manage",pId:"Custom_center",name:"钩子管理"},{id:"ad_manage",pId:"Custom_center",name:"广告管理"}]},{id:"system_setting",pId:0,name:"系统设置",open:!0,children:[{id:"system_log",pId:"system_setting",name:"系统日志"},{id:"web_setting",pId:"system_setting",name:"站点设置"},{id:"read_setting",pId:"system_setting",name:"阅读设置"},{id:"attachment_setting",pId:"system_setting",name:"附件设置"},{id:"social_login_setting",pId:"system_setting",name:"社交登录设置"},{id:"update_online",pId:"system_setting",name:"在线更新"},{id:"system_info",pId:"system_setting",name:"系统信息"},{id:"bug_commit",pId:"system_setting",name:"BUG反馈"}]}],l=[],m={};$(document).ready(function(){$.fn.zTree.init($("#treeDemo"),j,k),e(),$("#py").bind("change",e),$("#sy").bind("change",e),$("#pn").bind("change",e),$("#sn").bind("change",e)}),a.powerCommit=function(){l=i.transformToArray(i.getNodes());for(var b=0;b<l.length;b++)m[l[b].id]=l[b].checked;console.log(m),c.modify(a.group.name,m).then(function(a){1===a.data.code&&$("#admin_user_group_all_power_modal").modal("hide")},function(a){})},a.setPower=function(b,c){a.group=c,a.userGroup=b;var d;d=""==a.group.power?{panel:"true",basic_info:"true",modify_password:"true",user_manage:"true",admin_user_group_all:"true",admin_user_group_add:"true",admin_user_all:"true",admin_user_add:"true",doc_manage:"true",category_manage:"true",doc_category_all:"true",doc_category_add:"true",menu_manage:"true",menu_edit:"true",menu_location:"true",tag_manage:"true",comment_manage:"true",message_manage:"true",write:"true",published:"true",wait_for_verify:"true",no_access:"true",draft:"true",recycle:"true",file_manage:"true",media_manage:"true",file_backup:"true",file_recover:"true",data_manage:"true",database_manage:"true",database_backup:"true",database_import:"true",database_compress:"true",database_optimise:"true",cache_manage:"true",cache_clear:"true",cache_settings:"true",count_manage:"true",data_count:"true",Custom_center:"true",theme_manage:"true",plugin_manage:"true",hook_manage:"true",ad_manage:"true",system_setting:"true",system_log:"true",web_setting:"true",read_setting:"true",attachment_setting:"true",social_login_setting:"true",update_online:"true",system_info:"true",bug_commit:"true"}:JSON.parse(a.group.power),l=i.transformToArray(i.getNodes());for(var e=0,f=l.length;e<f;e++)l[e].checked=function(a){return"true"===a?a=!0:"false"===a&&(a=!1),a}(d[l[e].id]);for(var g=0;g<l.length;g++)i.checkNode(l[g],l[g].checked,!0)},a.forbidden=function(a){c.forbidden(a).then(function(){g()},function(){})},a.startUsing=function(a){c.startUsing(a).then(function(){g()},function(){})},a.edit=function(b){a.user=b,a.pidOptions=[{name:"无",id:0},{name:"超级管理员",id:1},{name:"网站管理员",id:2},{name:"内容管理员",id:3}],a.pid=a.user.pid},a.editCommit=function(a){var b=a.name,c=a.pid,e=a.remark,f="超级管理员";switch(b){case"超级管理员":f=1;break;case"网站管理员":f=2;break;case"内容管理员":f=3;break;default:f=4}d.edit(f,b,c,e).then(function(a){1===a.data.code&&$("#myModal").modal({keyboard:!0})},function(a){})}}]),app.controller("bannerManage",["$scope","$http","bannerManageService",function(a,b,c){a.editBanner=function(a){window.location.href="/admin/manage/doc_manage/banner_manage_edit/"+a.id+"/"+a.name},a.bannerItemAddCommit=function(){c.bannerItemAddCommit(a.name,a.remark).then(function(b){1===b.data.code?$("#banner_add_modal").modal("hide"):a.banner_add_modal_msg=b.data.msg},function(a){})},a.bannerGet=function(){c.bannerGet().then(function(b){a.bannerData=b.data},function(a){})}}]),app.controller("bannerManageEdit",["$scope","$http","bannerManageEditService","$sce","mediaManageAllService",function(a,b,c,d,e){a.getAllMedia=function(){a.everyPageLimitOptions=[{id:"5",name:"每页显示5条数据"},{id:"10",name:"每页显示10条数据"},{id:"20",name:"每页显示20条数据"},{id:"50",name:"每页显示50条数据"}],a.every_page_limit=a.everyPageLimitOptions[0].id,e.getAllMedia().then(function(b){a.count=b.data.count,a.allPage=b.data.allPage,a.currentPage=1,a.data=b.data.allMediaByLimit,a.dataUpload=b.data.upload;for(var c=[],d=[],e=0;e<a.dataUpload.length;e++){var f=a.dataUpload[e].upload_time.slice(0,7);-1===c.indexOf(f)&&c.push(f)}for(var g=0;g<c.length;g++){var h=c[g].slice(0,4),i=c[g].slice(5,7);d.push({name:h+"年"+i+"月",id:h+"-"+i})}d.unshift({name:"全部时间",id:"allTime"}),a.uniqueYearMonthOptions=d,a.unique_year_month=a.uniqueYearMonthOptions[0].id,a.mediaTypeOptions=[{id:"image",name:"图片文件"}],a.media_type=a.mediaTypeOptions[0].id},function(a){})},a.filterData=function(){e.filterData(a.media_type,a.unique_year_month,a.every_page_limit).then(function(b){a.data=b.data.upload,a.count=b.data.count,a.allPage=b.data.allPage,a.currentPage=1},function(a){})},a.listStyle=1,a.changeListStyle=function(b){a.listStyle=b?1:0},a.editBanner=function(){window.location.href="/admin/manage/doc_manage/banner_manage_edit"},a.selectBanner=function(a){},a.goToPage=function(b){e.goToPage(a.media_type,a.unique_year_month,a.every_page_limit,b).then(function(c){a.data=c.data,a.currentPage=b},function(a){})},a.addToBanner=function(){var b=$("#banner_id").attr("value");a.sliderDataNewAll=a.sliderDataNewAll.concat(a.selected);for(var c=0;c<a.selected.length;c++){var d=a.selected[c].url.match(/\/public\/upload\/(image|zip|rar|pdf)\/\d{8}/)[0]+"/"+a.selected[c].filename_now;a.sliderDataNew.push({banner_id:b,img_src:d,title:"",url:"",img_title:"",img_alt:""})}a.selected=[],a.sliderDataExist=a.sliderDataExist.concat(a.sliderDataNew),a.sliderDataNew=[],$("#banner_manage_edit_add_modal").modal("hide")},a.selected=[],a.selectOnePicture=function(b){if(-1==a.selected.indexOf(b))return void a.selected.push(b);if(-1!=a.selected.indexOf(b)){var c=a.selected.indexOf(b);a.selected.splice(c,1)}},a.sliders=[],a.saveSlider=function(){var b=$("#banner_id").attr("value");if(a.sliderDataNewAll.length>0)for(var d=0;d<a.sliderDataNewAll.length;d++){var e=a.sliderDataNewAll[d].url.match(/\/public\/upload\/(image|zip|rar|pdf)\/\d{8}/)[0]+"/"+a.sliderDataNewAll[d].filename_now;a.sliderDataNewAllFormat.push({banner_id:b,img_src:e,title:"",url:"",img_title:"",img_alt:""})}console.log(a.sliderDataExist),c.saveSlider(b,a.sliderDataExist,a.sliderDataNewAllFormat).then(function(b){1===b.data.code&&(a.bannerManageEditSaveMsg=b.data.msg,a.sliderDataNewAll=[],a.sliderDataNewAllFormat=[],$("#banner_manage_edit_save_modal").modal({keyboard:!0}))},function(a){})},a.sliderGet=function(){var b=$("#banner_id").attr("value");a.sliderDataNew=[],a.sliderDataNewAll=[],a.sliderDataNewAllFormat=[],c.sliderGet(b).then(function(b){a.sliderDataExist=b.data},function(a){})}}]),app.controller("basicInfo",["$scope","$http","basicInfoService",function(a,b,c){}]),app.controller("categoryAdd",["$scope","$http","categoryAllService","$sce","categoryAddService",function(a,b,c,d,e){c.getCategories().then(function(b){var c=b.data,d=[];if(0!==c.length){for(var e=0;e<c.length;e++)"0"===c[e].parent&&d.push({name:c[e].name,id:c[e].slug,slug:c[e].slug,order:c[e].order});for(var f=0;f<d.length;f++)for(var g=0;g<c.length;g++)d[f].id===c[g].parent&&d.splice(f+1,0,{name:"└"+c[g].name,id:c[g].slug,slug:c[g].slug,order:c[g].order})}d.unshift({name:"无",id:"0",parent:0}),a.cateOptions=d,console.log(a.cateOptions),a.parent=a.cateOptions[0].id},function(a){}),a.categoryAdd=function(){a.myForm.$valid&&e.addCategory(a.name,a.slug,a.order,a.parent,a.remark).then(function(b){b.data.code,a.msg=b.data.msg,$("#category_add_modal").modal({keyboard:!0})},function(a){})},a.editCategoryCommit=function(){}}]),app.controller("categoryAll",["$scope","$http","categoryAllService",function(a,b,c){a.getCategories=function(){c.getCategories().then(function(b){for(var c=b.data,d=[],e=0;e<c.length;e++)"0"===c[e].parent&&d.push({name:c[e].name,id:c[e].slug,slug:c[e].slug,parent:c[e].parent,remark:c[e].remark,order:c[e].order,original_id:c[e].id});for(var f=0;f<d.length;f++)for(var g=0;g<c.length;g++)d[f].id===c[g].parent&&d.splice(f+1,0,{name:"└"+c[g].name,id:c[g].slug,slug:c[g].slug,parent:c[g].parent,remark:c[g].remark,order:c[g].order,original_id:c[g].id});a.data=d;var h=d.slice(0);h.unshift({name:"无",id:"0"}),a.cateOptions=h,a.cate=a.cateOptions[0].id},function(a){})},a.edit=function(b){if(a.category=b,a.newCategory=function(a){var b={};for(var c in a)b[c]=a[c];return b.uber=a,b}(b),0==a.newCategory.parent)a.cate=a.cateOptions[0].id;else for(var c=0;c<a.cateOptions.length;c++)a.cateOptions[c].slug===a.newCategory.parent&&(a.cate=a.cateOptions[c].id)},a.editCategoryCommit=function(){c.editCategoryCommit(a.newCategory.original_id,a.newCategory.name,a.newCategory.slug,a.newCategory.parent,a.newCategory.order,a.newCategory.remark).then(function(b){1===b.data.code?(a.getCategories(),$("#category_all_edit_modal").modal("hide")):a.category_edit_msg=b.data.msg},function(a){})},a.remove=function(b){a.category_for_remove=b},a.removeCommit=function(){c.removeCommit(a.category_for_remove.original_id).then(function(b){if(1===b.data.code){for(var c=0;c<a.data.length;c++)if(a.data[c].original_id===a.category_for_remove.original_id){var d=c;break}a.data.splice(d,1),$("#category_all_remove_modal").modal("hide")}},function(a){})}}]),app.controller("documentAll",["$scope","$http","documentAllService",function(a,b,c){
c.postLimitAndPage(5,1).then(function(b){a.data=b.data.documentYesDisplayByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.limit="5",a.currentPage=1,a.getPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentYesDisplayByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.currentPage=1},a.goToPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentYesDisplayByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum,a.currentPage=d},function(a){})},a.removeOneDocument=function(b){a.oneDocument=b,$("#remove_one_document_modal").modal({keyboard:!0})},a.removeOneDocumentCommit=function(b){console.log(a.document_display.name),1==a.document_display.name?c.putIntoRecycle(b).then(function(b){1===b.data.code&&($("#remove_one_document_modal").modal("hide"),a.getPage())},function(a){}):c.removeOneDocument(b).then(function(b){1===b.data.code&&($("#remove_one_document_modal").modal("hide"),a.getPage())},function(a){})}}]),app.controller("documentEdit",["$scope","$http","documentEditService","categoriesAllService","$location",function(a,b,c,d,e){var f=e.absUrl(),g=/admin\/manage\/document_manage\/edit\/[a-z0-9]{24}/.exec(f)[0].slice(34,58);c.postEditId(g).then(function(b){a.data=b.data[0],a.document_title=a.data.document_title,a.document_from=a.data.document_from,a.document_display={name:String(a.data.document_display)},a.document_hot={name:String(a.data.document_hot)},a.document_recommend={name:String(a.data.document_recommend)},a.document_tags=a.data.document_tags,a.documentImg=a.data.document_img,console.log(a.documentImg),a.document_keywords=a.data.document_keywords,a.document_abstract=a.data.document_abstract,a.document_type={name:String(a.data.document_type)},a.document_view=a.data.document_view,a.document_author=a.data.document_author,ue.ready(function(){ue.setContent(a.data.document_content,!1)}),d.getCategories().then(function(b){for(var c=b.data,d=[],e=0;e<c.length;e++)""===c[e].cate_parent&&d.push({name:c[e].cate_name,id:c[e].cate_slug,cate_name:c[e].cate_name,cate_slug:c[e].cate_slug,cate_parent:c[e].cate_parent});for(var f=0;f<d.length;f++)for(var g=0;g<c.length;g++)d[f].id===c[g].cate_parent&&d.splice(f+1,0,{name:c[g].cate_name,id:c[g].cate_slug,cate_name:c[g].cate_name,cate_slug:c[g].cate_slug,cate_parent:c[g].cate_parent});a.cateOptions=d;for(var h=1,i=0;i<d.length;i++)if(d[i].cate_slug==a.data.document_category){h=i;break}a.document_category=a.cateOptions[h].id},function(a){})},function(a){}),a.updateDocument=function(){ue.ready(function(){a.document_content=ue.getContent()}),c.update(g,a.document_title,a.document_from,a.document_display.name,a.document_hot.name,a.document_recommend.name,a.document_tags,a.document_category,a.document_keywords,a.document_abstract,a.document_type.name,a.document_view,a.document_author,a.document_content).then(function(a){},function(a){})},$("#document_img").uploadify({swf:"/plugins/uploadify/uploadify.swf",uploader:"/admin/manage/document_manage/upload?documentTitle=document_title&type=images&key=document_img&id="+g,buttonText:"上传图片",buttonClass:"uploadify-btn-default",width:100,height:30,fileTypeDesc:"Image Files",fileTypeExts:"*.gif; *.jpg; *.png",fileSizeLimit:"2000KB",auto:!0,multi:!1,onUploadSuccess:function(b,c,d){a.documentImg=c}})}]),app.controller("docWrite",["$scope","$http","docWriteService","categoryAllService","gatherManageService",function(a,b,c,d,e){d.getCategories().then(function(b){for(var c=b.data,d=[],e=0;e<c.length;e++)"0"===c[e].parent&&d.push({name:c[e].name,id:c[e].slug,slug:c[e].slug,parent:c[e].parent,remark:c[e].remark,order:c[e].order,original_id:c[e].id});for(var f=0;f<d.length;f++)for(var g=0;g<c.length;g++)d[f].id===c[g].parent&&d.splice(f+1,0,{name:"└"+c[g].name,id:c[g].slug,slug:c[g].slug,parent:c[g].parent,remark:c[g].remark,order:c[g].order,original_id:c[g].id});a.data=d;var h=d.slice(0);a.cateOptions=h,a.cate=a.cateOptions[0].id},function(a){}),a.type={name:"post"},a.docWrite=function(){if(a.myForm.$valid){var b="";ue.ready(function(){b=ue.getContent(),a.content=b}),a.previewImg=$("#doc_preview_img_preview").attr("src"),c.get(a.type.name,a.title,a.previewImg,a.tag.split(","),a.category,a.abstract,a.keyword,a.view,a.author,a.from,a.content).then(function(a){1===a.data.code&&(window.location.href="/admin/manage/doc_manage/edit_doc/"+a.data.id)},function(a){})}},a.gatherDoc=function(){e.getGather().then(function(b){if(1===b.data.code){a.gatherData=b.data.data,a.gatherOptions=[];for(var c=0;c<b.data.data.length;c++)a.gatherOptions.push({name:b.data.data[c].site_name,id:b.data.data[c].id});a.gather=a.gatherOptions[0].id}},function(a){})},a.gatherDocCommit=function(){c.gatherDocCommit(a.gather,a.gatherUrl).then(function(b){1===b.data.code&&(a.title=b.data.gatheredData.title,ue.ready(function(){ue.setContent(b.data.gatheredData.content,!1)}),$("#write_doc_gather_modal").modal("hide"))},function(a){})}}]),app.controller("draft",["$scope","$http","draftService",function(a,b,c){c.postLimitAndPage(5,1).then(function(b){a.data=b.data.documentByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.limit="5",a.currentPage=1,a.getPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.currentPage=1},a.goToPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum,a.currentPage=d},function(a){})},a.removeOneDocument=function(b){a.oneDocument=b,$("#remove_one_document_modal").modal({keyboard:!0})},a.removeOneDocumentCommit=function(b){a.document_display={name:"1"},1==a.document_display.name?c.putIntoRecycle(b).then(function(b){1===b.data.code&&($("#remove_one_document_modal").modal("hide"),a.getPage())},function(a){}):c.removeOneDocument(b).then(function(b){1===b.data.code&&($("#remove_one_document_modal").modal("hide"),a.getPage())},function(a){})}}]),app.controller("editDoc",["$scope","$http","editDocService","categoryAllService",function(a,b,c,d){a.getDocById=function(){var b=$("#doc_id").val();c.getDocById(b).then(function(b){1===b.data.code&&(a.type={name:String(b.data.data.type)},a.title=b.data.data.title,$("#edit_doc_preview_img_preview").attr("src",b.data.data.preview_img),a.tag=b.data.data.tag,a.abstract=b.data.data.abstract,a.keyword=b.data.data.keyword,a.view=b.data.data.view,a.author=b.data.data.author,a.from=b.data.data.from,a.tag=b.data.data.tag,ue.ready(function(){ue.setContent(b.data.data.content,!1)}))},function(a){})},d.getCategories().then(function(b){for(var c=b.data,d=[],e=0;e<c.length;e++)"0"===c[e].parent&&d.push({name:c[e].name,id:c[e].slug,slug:c[e].slug,parent:c[e].parent,remark:c[e].remark,order:c[e].order,original_id:c[e].id});for(var f=0;f<d.length;f++)for(var g=0;g<c.length;g++)d[f].id===c[g].parent&&d.splice(f+1,0,{name:"└"+c[g].name,id:c[g].slug,slug:c[g].slug,parent:c[g].parent,remark:c[g].remark,order:c[g].order,original_id:c[g].id});a.data=d;var h=d.slice(0);a.cateOptions=h,a.category=a.cateOptions[0].id},function(a){}),a.updateDoc=function(){ue.ready(function(){a.content=ue.getContent()}),a.previewImg=$("#edit_doc_preview_img_preview").attr("src");var b=$("#doc_id").val();c.updateDoc(b,a.type.name,a.title,a.previewImg,a.tag,a.category,a.abstract,a.keyword,a.view,a.author,a.from,a.content).then(function(a){},function(a){})}}]),app.controller("gatherManage",["$scope","$http","gatherManageService",function(a,b,c){a.getGather=function(){c.getGather().then(function(b){1===b.data.code&&(a.gatherData=b.data.data)},function(a){})},a.addGather=function(){c.addGather(a.siteName,a.docTitle,a.docContent).then(function(a){},function(a){})},a.autoGather=function(){c.autoGather(a.siteName,a.docTitle,a.docContent).then(function(a){},function(a){})}}]),app.controller("headerCtrl",["$scope","$http","headerCtrlService",function(a,b,c){a.logout=function(){c.logout().then(function(a){1===a.data.code&&(window.location.href="/admin")},function(a){})}}]),app.controller("mediaManageAll",["$scope","$http","mediaManageAllService",function(a,b,c){a.getAllMedia=function(){a.everyPageLimitOptions=[{id:"5",name:"每页显示5条数据"},{id:"10",name:"每页显示10条数据"},{id:"20",name:"每页显示20条数据"},{id:"50",name:"每页显示50条数据"}],a.every_page_limit=a.everyPageLimitOptions[0].id,c.getAllMedia().then(function(b){a.count=b.data.count,a.allPage=b.data.allPage,a.currentPage=1,a.data=b.data.allMediaByLimit,a.dataUpload=b.data.upload;for(var c=[],d=[],e=0;e<a.dataUpload.length;e++){var f=a.dataUpload[e].upload_time.slice(0,7);-1===c.indexOf(f)&&c.push(f)}for(var g=0;g<c.length;g++){var h=c[g].slice(0,4),i=c[g].slice(5,7);d.push({name:h+"年"+i+"月",id:h+"-"+i})}d.unshift({name:"全部时间",id:"allTime"}),a.uniqueYearMonthOptions=d,a.unique_year_month=a.uniqueYearMonthOptions[0].id,a.mediaTypeOptions=[{id:"allFile",name:"所有文件"},{id:"image",name:"图片文件"},{id:"zip",name:"ZIP压缩文件"},{id:"rar",name:"RAR压缩文件"},{id:"pdf",name:"PDF文件"},{id:"video",name:"视频文件"}],a.media_type=a.mediaTypeOptions[0].id},function(a){})},a.filterData=function(){c.filterData(a.media_type,a.unique_year_month,a.every_page_limit).then(function(b){a.data=b.data.upload,a.count=b.data.count,a.allPage=b.data.allPage,a.currentPage=1},function(a){})},a.listStyle=1,a.changeListStyle=function(b){a.listStyle=b?1:0},a.gotoMediaManageUpload=function(){window.location.href="/admin/manage/file_manage/media_manage_upload"},a.goToPage=function(b){c.goToPage(a.media_type,a.unique_year_month,a.every_page_limit,b).then(function(c){a.data=c.data,a.currentPage=b},function(a){})}}]),app.controller("mediaManageUpload",["$scope","$http","mediaManageAllService",function(a,b,c){a.passwordModify=function(){passwordModifyService.get(a.adminUser_password,a.adminUser_repassword).then(function(a){1===a.data.code&&$("#password_modify_modal").modal({keyboard:!0})},function(a){})}}]),app.controller("menuManage",["$scope","$http","menuManageService",function(a,b,c){a.addMenu=function(){a.targetForAddMenuOptions=[{name:"新页面",id:1},{name:"当前页",id:0}],a.targetForAddMenu=a.targetForAddMenuOptions[0].id,c.getParentMenu().then(function(b){if(a.parentForAddMenuOptions=[],1===b.data.code){for(var c=0;c<b.data.data.length;c++)a.parentForAddMenuOptions.push({name:b.data.data[c].name,id:b.data.data[c].id});a.parentForAddMenuOptions.unshift({name:"无",id:0}),a.parentForAddMenu=a.parentForAddMenuOptions[0].id}},function(a){}),a.getMenu()},a.addMenuCommit=function(){c.addMenuCommit(a.name,a.url,a.targetForAddMenu,a.parentForAddMenu,a.order).then(function(b){1===b.data.code&&($("#menu_manage_add_menu_modal").modal("hide"),a.getMenu())},function(a){})},a.getMenu=function(){c.getMenu().then(function(b){if(1===b.data.code){a.menuData=b.data.data,a.topMenuData=[];for(var c=0;c<b.data.topMenu.length;c++){a.topMenuData.push(b.data.topMenu[c]);for(var d=0;d<b.data.data.length;d++)b.data.data[d].parent==b.data.topMenu[c].name&&a.topMenuData.push(b.data.data[d])}}},function(a){})},a.removeMenu=function(b){a.menuWaitingForRemove=b},a.removeMenuCommit=function(){c.removeMenuCommit(a.menuWaitingForRemove.id).then(function(b){1===b.data.code&&($("#menu_manage_remove_menu_modal").modal("hide"),a.getMenu())},function(a){})},a.editMenu=function(b){a.menuWaitingForEdit=b,a.newMenuWaitingForEdit=function(a){var b={};for(var c in a)b[c]=a[c];return b.uber=a,b}(b),a.targetForEditMenuOptions=[{name:"新页面",id:1},{name:"当前页",id:0}];for(var d=0;d<a.targetForEditMenuOptions.length;d++)a.targetForEditMenuOptions[d].id==a.menuWaitingForEdit.target&&(a.targetForEditMenu=a.targetForEditMenuOptions[d].id);c.getParentMenu().then(function(b){for(var c=0;c<b.data.data.length;c++)a.menuWaitingForEdit.id===b.data.data[c].id&&b.data.data.splice(c,1);if(a.parentForEditMenuOptions=[],1===b.data.code){for(var d=0;d<b.data.data.length;d++)a.parentForEditMenuOptions.push({name:b.data.data[d].name,id:b.data.data[d].id});console.log(a.newMenuWaitingForEdit),console.log(a.parentForEditMenuOptions),a.parentForEditMenuOptions.unshift({name:"无",id:0});for(var e=0;e<a.parentForEditMenuOptions.length;e++)a.parentForEditMenuOptions[e].id==a.menuWaitingForEdit.parent&&(a.parentForEditMenu=a.parentForEditMenuOptions[e].id)}},function(a){})},a.editMenuCommit=function(){c.editMenuCommit(a.menuWaitingForEdit.id,a.newMenuWaitingForEdit.name,a.newMenuWaitingForEdit.url,a.targetForEditMenu,a.parentForEditMenu,a.newMenuWaitingForEdit.order).then(function(b){1===b.data.code&&($("#menu_manage_edit_menu_modal").modal("hide"),a.getMenu())},function(a){})}}]),app.controller("modifyPassword",["$scope","$http","modifyPasswordService",function(a,b,c){a.passwordModify=function(){passwordModifyService.get(a.adminUser_password,a.adminUser_repassword).then(function(a){1===a.data.code&&$("#password_modify_modal").modal({keyboard:!0})},function(a){})}}]),app.controller("noAccess",["$scope","$http","noAccessService",function(a,b,c){c.postLimitAndPage(5,1).then(function(b){a.data=b.data.documentByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.limit="5",a.currentPage=1,a.getPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.currentPage=1},a.goToPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum,a.currentPage=d},function(a){})},a.removeOneDocument=function(b){a.oneDocument=b,$("#remove_one_document_modal").modal({keyboard:!0})},a.removeOneDocumentCommit=function(b){a.document_display={name:"1"},1==a.document_display.name?c.putIntoRecycle(b).then(function(b){1===b.data.code&&($("#remove_one_document_modal").modal("hide"),a.getPage())},function(a){}):c.removeOneDocument(b).then(function(b){1===b.data.code&&($("#remove_one_document_modal").modal("hide"),a.getPage())},function(a){})}}]),app.controller("published",["$scope","$http","publishedService",function(a,b,c){a.limit="5",a.currentPage=1,a.getPublishedByLimitAndCurrentPage=function(b,d){c.getPublishedByLimitAndCurrentPage(b,d).then(function(b){a.data=b.data.data,a.count=b.data.count,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum,a.currentPage=d},function(a){}),a.currentPage=1},a.recommend=function(a,b,d){c.recommend(a,b).then(function(a){1===a.data.code&&(1===a.data.action?d.recommend="是":d.recommend="否")},function(a){})},a.hot=function(a,b,d){c.hot(a,b).then(function(a){1===a.data.code&&(1===a.data.action?d.hot="是":d.hot="否")},function(a){})},a.removeOneDoc=function(b){a.oneDoc=b,$("#remove_one_doc_modal").modal({keyboard:!0})},a.removeOneDocCommit=function(b){a.status={name:"1"},1==a.status.name?c.putIntoRecycle(b).then(function(b){1===b.data.code&&($("#remove_one_doc_modal").modal("hide"),a.getPublishedByLimitAndCurrentPage(a.limit,a.currentPage))},function(a){}):c.removeOneDoc(b).then(function(b){1===b.data.code&&($("#remove_one_doc_modal").modal("hide"),a.getPage())},function(a){})},a.editDoc=function(a){window.location.href="/admin/manage/doc_manage/edit_doc/"+a.id}}]),app.controller("recycle",["$scope","$http","recycleService",function(a,b,c){c.postLimitAndPage(5,1).then(function(b){a.data=b.data.documentNoDisplayByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.limit="5",a.currentPage=1,a.getPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentNoDisplayByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum},function(a){}),a.currentPage=1},a.goToPage=function(b,d){c.postLimitAndPage(b,d).then(function(b){a.data=b.data.documentNoDisplayByLimitAndPage,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum,a.currentPage=d},function(a){})},a.removeOneDocument=function(b){a.oneDocument=b,$("#remove_one_document_complete_modal").modal({keyboard:!0})},a.removeOneDocumentCommit=function(b){c.removeOneDocument(b).then(function(b){1===b.data.code&&($("#remove_one_document_complete_modal").modal("hide"),a.getPage())},function(a){})}}]),app.controller("userGroupManageCtrl",["$scope","$http","userGroupManageService",function(a,b,c){function d(){g=$.fn.zTree.getZTreeObj("treeDemo"),py=$("#py").attr("checked")?"p":"",sy=$("#sy").attr("checked")?"s":"",pn=$("#pn").attr("checked")?"p":"",sn=$("#sn").attr("checked")?"s":"",type={Y:py+sy,N:pn+sn},g.setting.check.chkboxType=type,e('setting.check.chkboxType = { "Y" : "'+type.Y+'", "N" : "'+type.N+'" };')}function e(a){f||(f=$("#code")),f.empty(),f.append("<li>"+a+"</li>")}a.statusOptions=[{name:"启用",id:1},{name:"禁用",id:0}],a.status=a.statusOptions[0].id,a.pidOptions=[{name:"无",id:0},{name:"超级管理员",id:1},{name:"网站管理员",id:2},{name:"内容管理员",id:3},{name:"前台用户组",id:4}],a.pid=a.pidOptions[0].id,a.addUserGroup=function(){var b=a.name,d=a.pid,e=a.status,f=a.remark,g="超级管理员";switch(b){case"超级管理员":g=1;break;case"网站管理员":g=2;break;case"内容管理员":g=3}c.addAdminUserGroup(g,b,d,e,f).then(function(b){1===b.data.code?(a.msg=b.data.msg,$("#user_group_manage_add_modal").modal("hide")):0===b.data.code&&(a.msg=b.data.msg,$("#user_group_manage_add_modal").modal({keyboard:!0}))},function(a){})},a.getUserGroup=function(){c.getUserGroup().then(function(b){a.data=b.data},function(a){})},a.powerCommit=function(){j=g.transformToArray(g.getNodes());for(var b=0;b<j.length;b++)k[j[b].id]=j[b].checked;c.powerCommit(a.group.name,k).then(function(b){1===b.data.code&&(a.getUserGroup(),$("#admin_user_group_all_power_modal").modal("hide"))},function(a){})};var f,g,h={check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"ps",N:"ps"}},data:{simpleData:{enable:!0}},callback:{}},i=[{id:"panel",pId:0,name:"仪表盘",open:!0,children:[{id:"basic_info",pId:"panel",name:"基本信息"},{id:"modify_password",pId:"panel",name:"修改密码"}]},{id:"user_manage_d",pId:0,name:"用户管理",open:!0,children:[{id:"user_group_manage",pId:"user_manage_d",name:"用户组管理"},{id:"user_manage",pId:"user_manage_d",name:"用户管理"}]},{id:"doc_manage",pId:0,name:"文档管理",open:!0,children:[{id:"category_manage",pId:"doc_manage",name:"分类管理",open:!0,children:[{id:"doc_category_all",pId:"category_manage",name:"文档分类"},{id:"doc_category_add",pId:"category_manage",name:"添加分类"}]},{id:"menu_manage",pId:"doc_manage",name:"菜单管理",open:!0,children:[{id:"menu_edit",pId:"menu_manage",name:"编辑菜单"},{id:"menu_location",pId:"menu_manage",name:"菜单位置"}]},{id:"tag_manage",pId:"doc_manage",name:"标签管理"},{id:"comment_manage",pId:"doc_manage",name:"评论管理"},{id:"message_manage",pId:"doc_manage",name:"消息管理"},{id:"write",pId:"doc_manage",name:"写文档"},{id:"published",pId:"doc_manage",name:"已发布"},{id:"wait_for_verify",pId:"doc_manage",name:"待审核"},{id:"no_access",pId:"doc_manage",name:"未通过"},{id:"draft",pId:"doc_manage",name:"草稿箱"},{id:"recycle",pId:"doc_manage",name:"回收站"}]},{id:"file_manage",pId:0,name:"文件管理",open:!0,children:[{id:"media_manage",pId:"file_manage",name:"媒体管理"},{id:"file_backup",pId:"file_manage",name:"文件备份"},{id:"file_recover",pId:"file_manage",name:"文件恢复"}]},{id:"data_manage",pId:0,name:"数据管理",open:!0,children:[{id:"database_manage",pId:"data_manage",name:"数据库管理",open:!0,children:[{id:"database_backup",pId:"data_manage",name:"数据库备份"},{id:"database_import",pId:"data_manage",name:"数据库导入"},{id:"database_compress",pId:"data_manage",name:"数据库压缩"},{id:"database_optimise",pId:"data_manage",name:"数据库优化"}]},{id:"cache_manage",pId:"data_manage",name:"缓存管理",open:!0,children:[{id:"cache_clear",pId:"cache_manage",name:"缓存清理"},{id:"cache_settings",pId:"cache_manage",name:"缓存设置"}]},{id:"count_manage",pId:"data_manage",name:"统计管理",open:!0,children:[{id:"data_count",pId:"count_manage",name:"数据统计"}]}]},{id:"Custom_center",pId:0,name:"定制中心",open:!0,children:[{id:"theme_manage",pId:"Custom_center",name:"主题管理"},{id:"plugin_manage",pId:"Custom_center",name:"插件管理"},{id:"hook_manage",pId:"Custom_center",name:"钩子管理"},{id:"ad_manage",pId:"Custom_center",name:"广告管理"}]},{id:"system_setting",pId:0,name:"系统设置",open:!0,children:[{id:"system_log",pId:"system_setting",name:"系统日志"},{id:"web_setting",pId:"system_setting",name:"站点设置"},{id:"read_setting",pId:"system_setting",name:"阅读设置"},{id:"attachment_setting",pId:"system_setting",name:"附件设置"},{id:"social_login_setting",pId:"system_setting",name:"社交登录设置"},{id:"update_online",pId:"system_setting",name:"在线更新"},{id:"system_info",pId:"system_setting",name:"系统信息"},{id:"bug_commit",pId:"system_setting",name:"BUG反馈"}]}],j=[],k={};$(document).ready(function(){$.fn.zTree.init($("#treeDemo"),h,i),d(),$("#py").bind("change",d),$("#sy").bind("change",d),$("#pn").bind("change",d),$("#sn").bind("change",d)}),a.setPower=function(b,c){a.group=c,a.userGroup=b;var d;""==a.group.power?(d={panel:"true",basic_info:"true",modify_password:"true",user_manage_d:"true",user_group_manage:"true",user_manage:"true",doc_manage:"true",category_manage:"true",doc_category_all:"true",doc_category_add:"true",menu_manage:"true",menu_edit:"true",menu_location:"true",tag_manage:"true",comment_manage:"true",message_manage:"true",write:"true",published:"true",wait_for_verify:"true",no_access:"true",draft:"true",recycle:"true",file_manage:"true",media_manage:"true",file_backup:"true",file_recover:"true",data_manage:"true",database_manage:"true",database_backup:"true",database_import:"true",database_compress:"true",database_optimise:"true",cache_manage:"true",cache_clear:"true",cache_settings:"true",count_manage:"true",data_count:"true",Custom_center:"true",theme_manage:"true",plugin_manage:"true",hook_manage:"true",ad_manage:"true",system_setting:"true",system_log:"true",web_setting:"true",read_setting:"true",attachment_setting:"true",social_login_setting:"true",update_online:"true",system_info:"true",bug_commit:"true"},console.log(1)):(d=JSON.parse(a.group.power),console.log(d)),j=g.transformToArray(g.getNodes());for(var e=0,f=j.length;e<f;e++)j[e].checked=function(a){return"true"===a?a=!0:"false"===a&&(a=!1),a}(d[j[e].id]);for(var h=0;h<j.length;h++)g.checkNode(j[h],j[h].checked,!0)},a.forbidden=function(b){c.forbidden(b).then(function(){a.getUserGroup()},function(){})},a.startUsing=function(b){c.startUsing(b).then(function(){a.getUserGroup()},function(){})},a.edit=function(b){a.user=b,a.pidOptions=[{name:"无",id:0},{name:"超级管理员",id:1},{name:"网站管理员",id:2},{name:"内容管理员",id:3}],a.pid=a.pidOptions[Number(a.user.pid)].id},a.editCommit=function(a){var b=a.name,d=a.pid,e=a.remark,f="超级管理员";switch(b){case"超级管理员":f=1;break;case"网站管理员":f=2;break;case"内容管理员":f=3;break;default:f=4}c.editCommit(f,b,d,e).then(function(a){1===a.data.code&&$("#myModal").modal({keyboard:!0})},function(a){})}}]),app.controller("verifyDoc",["$scope","$http","verifyDocService","categoryAllService",function(a,b,c,d){a.getDocById=function(){var b=$("#doc_id").val();c.getDocById(b).then(function(b){1===b.data.code&&(a.type={name:String(b.data.data.type)},a.title=b.data.data.title,$("#edit_doc_preview_img_preview").attr("src",b.data.data.preview_img),a.tag=b.data.data.tag,a.abstract=b.data.data.abstract,a.keyword=b.data.data.keyword,a.view=b.data.data.view,a.author=b.data.data.author,a.from=b.data.data.from,a.tag=b.data.data.tag,ue.ready(function(){ue.setContent(b.data.data.content,!1)}))},function(a){})},d.getCategories().then(function(b){for(var c=b.data,d=[],e=0;e<c.length;e++)"0"===c[e].parent&&d.push({name:c[e].name,id:c[e].slug,slug:c[e].slug,parent:c[e].parent,remark:c[e].remark,order:c[e].order,original_id:c[e].id});for(var f=0;f<d.length;f++)for(var g=0;g<c.length;g++)d[f].id===c[g].parent&&d.splice(f+1,0,{name:"└"+c[g].name,id:c[g].slug,slug:c[g].slug,parent:c[g].parent,remark:c[g].remark,order:c[g].order,original_id:c[g].id});a.data=d;var h=d.slice(0);a.cateOptions=h,a.category=a.cateOptions[0].id},function(a){}),a.verifyDoc=function(){ue.ready(function(){a.content=ue.getContent()}),a.previewImg=$("#edit_doc_preview_img_preview").attr("src");var b=$("#doc_id").val();c.verifyDoc(b,a.type.name,a.title,a.previewImg,a.tag,a.category,a.abstract,a.keyword,a.view,a.author,a.from,a.content).then(function(a){},function(a){})}}]),app.controller("waitForVerify",["$scope","$http","waitForVerifyService",function(a,b,c){a.limit="5",a.currentPage=1,a.getWaitForVerifyByLimitAndCurrentPage=function(b,d){c.getWaitForVerifyByLimitAndCurrentPage(b,d).then(function(b){a.data=b.data.data,a.count=b.data.count,a.allPage=b.data.allPage,a.documentCountNum=b.data.documentCountNum,a.currentPage=d},function(a){}),a.currentPage=1},a.removeOneDoc=function(b){a.oneDoc=b,$("#remove_one_doc_modal").modal({keyboard:!0})},a.removeOneDocCommit=function(b){a.status={name:"1"},1==a.status.name?publishedService.putIntoRecycle(b).then(function(b){1===b.data.code&&($("#remove_one_doc_modal").modal("hide"),a.getPublishedByLimitAndCurrentPage(a.limit,a.currentPage))},function(a){}):publishedService.removeOneDoc(b).then(function(b){1===b.data.code&&($("#remove_one_doc_modal").modal("hide"),a.getPage())},function(a){})},a.editDoc=function(a){window.location.href="/admin/manage/doc_manage/verify_doc/"+a.id}}]);